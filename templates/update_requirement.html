{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Edit Requirement</h2>
    <a href="{{ url_for('requirements') }}" class="btn btn-secondary">
      <i class="bi bi-arrow-left me-2"></i>Back to Requirements
    </a>
  </div>

  <div class="card border-0 shadow">
    <div class="card-body">
      <form method="POST" action="{{ url_for('update_requirement', req_id=requirement.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="_method" value="PUT">

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Client Name</label>
              <input type="text" name="client_name" class="form-control" required
                     value="{{ request.form.get('client_name', requirement.client_name or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Client POC</label>
              <input type="text" name="client_poc" class="form-control"
                     placeholder="e.g. Alice Johnson (alice@client.com)"
                     value="{{ request.form.get('client_poc', requirement.client_poc or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Client LinkedIn Profile</label>
              <input type="url" name="client_linkedin_profile" class="form-control"
                     placeholder="https://www.linkedin.com/company/..."
                     value="{{ request.form.get('client_linkedin_profile', requirement.client_linkedin_profile or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Client Brief Description</label>
              <textarea name="client_brief_description" class="form-control" rows="3"
                        placeholder="One-line about client, domain, size, etc.">{{ request.form.get('client_brief_description', requirement.client_brief_description or '') }}</textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Requirement Name</label>
              <input type="text" name="requirement_name" class="form-control" required
                     value="{{ request.form.get('requirement_name', requirement.requirement_name or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Experience</label>
              <input type="text" name="experience" class="form-control" placeholder="e.g. 5-8 years"
                     value="{{ request.form.get('experience', requirement.experience or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Mandatory Skills</label>
              <textarea name="mandatory_skills" class="form-control" rows="3">{{ request.form.get('mandatory_skills', requirement.mandatory_skills or '') }}</textarea>
            </div>
          </div>

          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Job Locations</label>
              <input type="text" name="job_locations" class="form-control" placeholder="e.g. Bangalore, Hyderabad"
                     value="{{ request.form.get('job_locations', requirement.job_locations or '') }}">
            </div>

            <div class="mb-3 form-check form-switch">
              <input type="checkbox" name="remote" class="form-check-input" id="remoteSwitch"
                     {% if request.form.get('remote', requirement.remote) %}checked{% endif %}>
              <label class="form-check-label" for="remoteSwitch">Remote Position</label>
            </div>

            <div class="mb-3">
              <label class="form-label">Budget</label>
              <input type="text" name="budget" class="form-control" placeholder="e.g. ₹25–35 LPA"
                     value="{{ request.form.get('budget', requirement.budget or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Job Details (Internal)</label>
              <input type="text" name="job_d_th_d" class="form-control" placeholder="Internal notes / IDs"
                     value="{{ request.form.get('job_d_th_d', requirement.job_d_th_d or '') }}">
            </div>

            <div class="mb-3">
              <label class="form-label">Status</label>
              <select name="status" class="form-select" required>
                <option value="Active" {% if request.form.get('status', requirement.status) == 'Active' %}selected{% endif %}>Active</option>
                <option value="Hold" {% if request.form.get('status', requirement.status) == 'Hold' %}selected{% endif %}>Hold</option>
                <option value="Closed" {% if request.form.get('status', requirement.status) == 'Closed' %}selected{% endif %}>Closed</option>
              </select>
            </div>

            <!-- Multi-assign checklist (matches Add form) -->
            <div class="mb-3">
              <label class="form-label">Assign To (multiple)</label>
              <div class="border rounded p-2" style="max-height:220px; overflow:auto;">
                {% set selected_assigned = request.form.getlist('assigned_to') %}
                {% if not selected_assigned and requirement.assigned_to %}
                  {% set selected_assigned = (requirement.assigned_to or '').split(',') %}
                {% endif %}
                {% for uname in recruiters %}
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="assigned_to" value="{{ uname }}" id="chk_{{ loop.index }}"
                    {% if uname in selected_assigned %}checked{% endif %}>
                    <label class="form-check-label" for="chk_{{ loop.index }}">{{ uname }}</label>
                  </div>
                {% endfor %}
                {% if recruiters|length == 0 %}
                  <div class="text-muted small">No recruiters/admins found.</div>
                {% endif %}
              </div>
            </div>

          </div>
        </div>

        <div class="mb-4">
          <label class="form-label">Job Description</label>
          <textarea name="job_description" class="form-control" rows="5">{{ request.form.get('job_description', requirement.job_description or '') }}</textarea>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
          <button type="submit" class="btn btn-primary px-4">
            <i class="bi bi-save me-2"></i>Save Requirement
          </button>
          <a href="{{ url_for('requirements') }}" class="btn btn-outline-secondary px-4">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .form-label {
    font-weight: 600;       /* bold */
    color: #0d6efd;         /* bootstrap primary blue */
  }
</style>
{% endblock %}
