{% extends "base.html" %}
{% block content %}

<style>
/* Admin Team List Styling */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 20px;
}

h2 {
  font-size: 1.8rem;
  font-weight: 700;
  color: #111827;
  margin-bottom: 15px;
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 15px;
}

.table th, .table td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid #e5e7eb;
}

.table th {
  background-color: #f8fafc;
  font-weight: 700;
  color: #1e293b;
}

.table tr:hover {
  background-color: #f9fafb;
}

.btn {
  border: none;
  border-radius: 6px;
  padding: 5px 12px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
}

.btn-sm { padding: 4px 10px; font-size: 13px; }
.btn:hover { transform: scale(1.04); }

.btn-success { background-color: #16a34a; color: #fff; }
.btn-success:hover { background-color: #15803d; }

.btn-warning { background-color: #f59e0b; color: #111; }
.btn-warning:hover { background-color: #d97706; color: #fff; }

.btn-danger { background-color: #dc2626; color: #fff; }
.btn-danger:hover { background-color: #b91c1c; }

.btn-secondary { background-color: #e5e7eb; color: #111827; }
.btn-secondary:hover { background-color: #d1d5db; }

/* Flash messages */
.alert {
  padding: 12px 18px;
  margin: 15px auto;
  border-radius: 6px;
  width: 80%;
  text-align: center;
  font-weight: 500;
}
.alert-success { background-color: #dcfce7; color: #14532d; }
.alert-warning { background-color: #fef3c7; color: #92400e; }
.alert-info { background-color: #e0f2fe; color: #075985; }
</style>

<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ 'success' if category=='success' else ('warning' if category=='warning' else 'info') }}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h2>Manage Team</h2>
    <div>
      <a href="{{ url_for('myteam.admin_add') }}" class="btn btn-success">+ Add member</a>
      <a href="{{ url_for('myteam.teams') }}" class="btn btn-secondary">View public</a>
    </div>
  </div>

  <p style="color:#6b7280; margin-bottom:15px;">Admin panel â€” manage members</p>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Designation</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for m in members %}
        <tr>
          <td>{{ m.id }}</td>
          <td>{{ m.name }}</td>
          <td>{{ m.designation or '' }}</td>
          <td>{{ 'Yes' if m.is_active else 'No' }}</td>
          <td>
            <a href="{{ url_for('myteam.admin_edit', member_id=m.id) }}" class="btn btn-sm btn-secondary">Edit</a>

            <!-- Toggle Enable/Disable -->
            <form method="post" action="{{ url_for('myteam.admin_toggle', member_id=m.id) }}" style="display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              {% if m.is_active %}
                <button type="submit" class="btn btn-sm btn-warning">Disable</button>
              {% else %}
                <button type="submit" class="btn btn-sm btn-success">Enable</button>
              {% endif %}
            </form>

            <!-- Delete -->
            <form method="post" action="{{ url_for('myteam.admin_delete', member_id=m.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this member?');">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="5" style="text-align:center; color:#9ca3af;">No team members found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // Auto-dismiss flash messages after 3 seconds
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(a => a.remove());
  }, 3000);
</script>

{% endblock %}
