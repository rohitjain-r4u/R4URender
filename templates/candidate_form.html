{% extends "base.html" %}
{% block content %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<style>
  .multi-input .input-row { display:flex; gap:8px; margin-bottom:8px; }
  .multi-input .input-row input { flex:1 1 auto; }
  .chip { display:inline-block; padding:4px 8px; border-radius:12px; background:#eef2ff; margin:3px; }
</style>


<style>
/* Enhanced styling for candidate form - purely presentational */
.candidate-card {
  background: linear-gradient(180deg, #ffffff 0%, #f8fbff 100%);
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(33, 47, 77, 0.08);
  padding: 24px;
  border: 1px solid rgba(15, 23, 42, 0.04);
}
.candidate-header {
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:16px;
}
.candidate-avatar {
  width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#e6f2ff,#eef9f7);display:flex;align-items:center;justify-content:center;font-weight:700;color:#0f172a;
}
.field-label { font-weight:600; color:#0f172a; }
.small-muted { color:#6b7280; font-size:0.92rem; }
.form-section { background: rgba(255,255,255,0.6); padding:12px; border-radius:8px; margin-bottom:12px; }
.btn-accent { background: #0ea5e9; color: white; border: none; padding: 8px 14px; border-radius:8px; }
.btn-accent-outline { background: transparent; color: #0ea5e9; border:1px solid #bfdbfe; padding: 8px 14px; border-radius:8px; }
.input-chip { display:inline-block; padding:6px 10px; background:#eef2ff; border-radius:999px; margin-right:6px; margin-bottom:6px; font-size:0.9rem; }
.help-text { font-size:0.85rem; color:#6b7280; }
.multi-input .input-row { align-items:center; }
.remove-phone, .remove-email { margin-left:6px; }
.footer-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:18px; }
@media (max-width:767px) {
  .candidate-header { flex-direction:column; align-items:flex-start; gap:8px; }
  .footer-actions { flex-direction:column-reverse; }
}
</style>
<div class="container py-3"><div class="candidate-card">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <div class="candidate-header"><div class="candidate-avatar">CV</div><div><h3 class="mb-0">{{ candidate and 'Edit' or 'Add New' }} Candidate</h3><div class="small-muted">Edit candidate details — keep data accurate</div></div></div>
      <div class="small text-muted">{{ requirement.requirement_name }} — ID: {{ requirement.id }}</div>
    </div>
    <div>
      <a href="{{ url_for('requirement_candidates', req_id=requirement.id) }}" class="btn btn-outline-secondary">Back to Candidates</a>
    </div>
  </div>

  <form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Date of application</label>
        <input type="date" name="application_date" class="form-control"
       value="{{ data.application_date or (candidate.application_date.strftime('%Y-%m-%d') if candidate and candidate.application_date else '') or '' }}"
       onfocus="if(!this.value){ this.value = new Date().toISOString().slice(0,10); }">
      </div>

      <div class="col-md-5">
        <label class="form-label">Job Title</label>
        <input type="text" name="job_title" class="form-control" value="{{ data.job_title or candidate.job_title or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Candidate Name *</label>
        <input type="text" name="candidate_name" class="form-control" required value="{{ data.candidate_name or candidate.candidate_name or '' }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Current Company</label>
        <input type="text" name="current_company" class="form-control" value="{{ data.current_company or candidate.current_company or '' }}">
      </div>

      <div class="col-md-3">
        <label class="form-label">Total Experience</label>
        <input type="text" name="total_experience" class="form-control" value="{{ data.total_experience or candidate.total_experience or '' }}">
      </div>

      <!-- Phones -->
      <div class="col-12">
        <label class="form-label">Phone Number(s)</label>
        <div id="phones-wrapper" class="multi-input">
          {% set phones = data.phones if data and (data.phones is defined) else (candidate.phones if candidate else []) %}
          {% if phones %}
            {% for p in phones %}
              <div class="input-row phone-row">
                <input type="text" name="phones" class="form-control" value="{{ p }}">
                <button type="button" class="btn btn-outline-danger remove-phone">Remove</button>
              </div>
            {% endfor %}
          {% else %}
            <div class="input-row phone-row">
              <input type="text" name="phones" class="form-control" value="">
              <button type="button" class="btn btn-outline-danger remove-phone">Remove</button>
            </div>
          {% endif %}
        </div>
        <button type="button" id="add-phone" class="btn btn-sm btn-outline-primary mt-1">Add Phone</button>
      </div>

      <!-- Emails -->
      <div class="col-12">
        <label class="form-label">Email ID(s)</label>
        <div id="emails-wrapper" class="multi-input">
          {% set emails = data.emails if data and (data.emails is defined) else (candidate.emails if candidate else []) %}
          {% if emails %}
            {% for e in emails %}
              <div class="input-row email-row">
                <input type="email" name="emails" class="form-control" value="{{ e }}">
                <button type="button" class="btn btn-outline-danger remove-email">Remove</button>
              </div>
            {% endfor %}
          {% else %}
            <div class="input-row email-row">
              <input type="email" name="emails" class="form-control" value="">
              <button type="button" class="btn btn-outline-danger remove-email">Remove</button>
            </div>
          {% endif %}
        </div>
        <button type="button" id="add-email" class="btn btn-sm btn-outline-primary mt-1">Add Email</button>
      </div>

      <div class="col-md-4">
        <label class="form-label">Notice Period</label>
        <input type="text" name="notice_period" class="form-control" value="{{ data.notice_period or candidate.notice_period or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Current Location</label>
        <input type="text" name="current_location" class="form-control" value="{{ data.current_location or candidate.current_location or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Preferred Locations</label>
        <input type="text" name="preferred_locations" class="form-control" value="{{ data.preferred_locations or candidate.preferred_locations or '' }}">
      </div>

      <div class="col-md-3">
        <label class="form-label">CTC (Current)</label>
        <input type="number" step="0.01" name="ctc_current" class="form-control" value="{{ data.ctc_current or candidate.ctc_current or '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">ECTC (Expected)</label>
        <input type="number" step="0.01" name="ectc" class="form-control" value="{{ data.ectc or candidate.ectc or '' }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Key Skills</label>
        <input type="text" name="key_skills" class="form-control" value="{{ data.key_skills or candidate.key_skills or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Education</label>
        <input type="text" name="education" class="form-control" value="{{ data.education or candidate.education or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Post Graduation Degree</label>
        <input type="text" name="post_graduation" class="form-control" value="{{ data.post_graduation or candidate.post_graduation or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">PF & Docs Confirmation</label>
        <select name="pf_docs_confirm" class="form-select">
          <option value="">Select</option>
          <option value="1" {% if (data.pf_docs_confirm is defined and data.pf_docs_confirm == '1') or (candidate and (candidate.pf_docs_confirm == 1 or candidate.pf_docs_confirm == '1' or candidate.pf_docs_confirm is true)) %}selected{% endif %}>Yes</option>
          <option value="0" {% if (data.pf_docs_confirm is defined and data.pf_docs_confirm == '0') or (candidate and (candidate.pf_docs_confirm == 0 or candidate.pf_docs_confirm == '0' or candidate.pf_docs_confirm is false)) %}selected{% endif %}>No</option>
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Offer Details</label>
        <textarea name="notice_period_details" class="form-control" rows="2">{{ data.notice_period_details or candidate.notice_period_details or '' }}</textarea>
      </div>

      <div class="col-md-4">
        <label class="form-label">Current CTC in LPA</label>
        <input type="number" step="0.01" name="current_ctc_lpa" class="form-control" value="{{ data.current_ctc_lpa or candidate.current_ctc_lpa or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Expected CTC in LPA</label>
        <input type="number" step="0.01" name="expected_ctc_lpa" class="form-control" value="{{ data.expected_ctc_lpa or candidate.expected_ctc_lpa or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Employee Size (current company)</label>
        <input type="number" name="employee_size" class="form-control" value="{{ data.employee_size or candidate.employee_size or '' }}">
      </div>

      <div class="col-12">
        <label class="form-label">Companies Worked With Till Now</label>
        <input type="text" name="companies_worked" class="form-control" value="{{ data.companies_worked or candidate.companies_worked or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Calling Status</label>
        <select name="calling_status" class="form-select">
  <option value="">-- Select --</option>
  <option value="Screen Select" {% if (data.calling_status is defined and data.calling_status=='Screen Select') or (candidate and candidate.calling_status=='Screen Select') %}selected{% endif %}>Screen Select</option>
  <option value="CNS" {% if (data.calling_status is defined and data.calling_status=='CNS') or (candidate and candidate.calling_status=='CNS') %}selected{% endif %}>CNS</option>
  <option value="Not interested" {% if (data.calling_status is defined and data.calling_status=='Not interested') or (candidate and candidate.calling_status=='Not interested') %}selected{% endif %}>Not interested</option>
  <option value="Not Reachable" {% if (data.calling_status is defined and data.calling_status=='Not Reachable') or (candidate and candidate.calling_status=='Not Reachable') %}selected{% endif %}>Not Reachable</option>
  <option value="Rejected" {% if (data.calling_status is defined and data.calling_status=='Rejected') or (candidate and candidate.calling_status=='Rejected') %}selected{% endif %}>Rejected</option>
</select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Profile Status</label>
        <select name="profile_status" class="form-select">
  <option value="">-- Select --</option>
  <option value="Profile shared with client" {% if (data.profile_status is defined and data.profile_status=='Profile shared with client') or (candidate and candidate.profile_status=='Profile shared with client') %}selected{% endif %}>Profile shared with client</option>
  <option value="Review Pending by client" {% if (data.profile_status is defined and data.profile_status=='Review Pending by client') or (candidate and candidate.profile_status=='Review Pending by client') %}selected{% endif %}>Review Pending by client</option>
  <option value="R2 Pending" {% if (data.profile_status is defined and data.profile_status=='R2 Pending') or (candidate and candidate.profile_status=='R2 Pending') %}selected{% endif %}>R2 Pending</option>
  <option value="R3 Pending" {% if (data.profile_status is defined and data.profile_status=='R3 Pending') or (candidate and candidate.profile_status=='R3 Pending') %}selected{% endif %}>R3 Pending</option>
  <option value="R1 to be schedule" {% if (data.profile_status is defined and data.profile_status=='R1 to be schedule') or (candidate and candidate.profile_status=='R1 to be schedule') %}selected{% endif %}>R1 to be schedule</option>  
  <option value="F2F Scheduled" {% if (data.profile_status is defined and data.profile_status=='F2F Scheduled') or (candidate and candidate.profile_status=='HR Round') %}selected{% endif %}>F2F Scheduled</option>
  <option value="Screen Rejected" {% if (data.profile_status is defined and data.profile_status=='Screen Rejected') or (candidate and candidate.profile_status=='HR Round') %}selected{% endif %}>Screen Rejected</option>
  <option value="R2 scheduled" {% if (data.profile_status is defined and data.profile_status=='R2 scheduled') or (candidate and candidate.profile_status=='R2 scheduled') %}selected{% endif %}>R2 scheduled</option>
  <option value="R3 scheduled" {% if (data.profile_status is defined and data.profile_status=='R3 scheduled') or (candidate and candidate.profile_status=='R3 scheduled') %}selected{% endif %}>R3 scheduled</option>
  <option value="R1 scheduled" {% if (data.profile_status is defined and data.profile_status=='R1 scheduled') or (candidate and candidate.profile_status=='R1 scheduled') %}selected{% endif %}>R1 scheduled</option>
  <option value="R1 FBP" {% if (data.profile_status is defined and data.profile_status=='R1 FBP') or (candidate and candidate.profile_status=='R1 FBP') %}selected{% endif %}>R1 FBP</option>
  <option value="R2 FBP" {% if (data.profile_status is defined and data.profile_status=='R2 FBP') or (candidate and candidate.profile_status=='R2 FBP') %}selected{% endif %}>R2 FBP</option>
  <option value="R3 FBP" {% if (data.profile_status is defined and data.profile_status=='R3 FBP') or (candidate and candidate.profile_status=='R3 FBP') %}selected{% endif %}>R3 FBP</option>
  <option value="HR Round" {% if (data.profile_status is defined and data.profile_status=='HR Round') or (candidate and candidate.profile_status=='HR Round') %}selected{% endif %}>HR Round</option>
  <option value="Offered" {% if (data.profile_status is defined and data.profile_status=='Offered') or (candidate and candidate.profile_status=='Offered') %}selected{% endif %}>Offered</option>
  <option value="R2 Rejected" {% if (data.profile_status is defined and data.profile_status=='R2 Rejected') or (candidate and candidate.profile_status=='R2 Rejected') %}selected{% endif %}>R2 Rejected</option>
  <option value="R3 Rejected" {% if (data.profile_status is defined and data.profile_status=='R3 Rejected') or (candidate and candidate.profile_status=='R3 Rejected') %}selected{% endif %}>R3 Rejected</option>
  <option value="R1 Rejected" {% if (data.profile_status is defined and data.profile_status=='R1 Rejected') or (candidate and candidate.profile_status=='R1 Rejected') %}selected{% endif %}>R1 Rejected</option>
</select>
<div class="col-md-4">
        <label class="form-label">Interview date</label>
        <input type="date" name="interview_date" class="form-control" value="{{ data.interview_date or (candidate.interview_date.strftime('%Y-%m-%d') if candidate and candidate.interview_date else '') or '' }}">
      </div>

      <div class="col-md-4">
        <label class="form-label">Interview time</label>
        <input type="time" name="interview_time" class="form-control" value="{{ data.interview_time or candidate.interview_time or '' }}">
      </div>

      

      </div>

      <div class="col-12">
        <label class="form-label">Comments</label>
        <textarea class="form-control" name="comments" rows="4">{{ data.comments or candidate.comments or '' }}</textarea>
      </div>

      <div class="col-12 d-flex justify-content-end gap-2">
        <button class="btn btn-primary" type="submit">Save Candidate</button>
        <a class="btn btn-outline-secondary" href="{{ url_for('requirement_candidates', req_id=requirement.id) }}">Cancel</a>
      </div>
    </div>
  </form>
</div>

<script>
document.addEventListener('click', function(e) {
  if (e.target && e.target.id === 'add-phone') {
    const wrapper = document.getElementById('phones-wrapper');
    const row = document.createElement('div');
    row.className = 'input-row phone-row';
    row.innerHTML = '<input type="text" name="phones" class="form-control" value=""><button type="button" class="btn btn-outline-danger remove-phone">Remove</button>';
    wrapper.appendChild(row);
  } else if (e.target && e.target.id === 'add-email') {
    const wrapper = document.getElementById('emails-wrapper');
    const row = document.createElement('div');
    row.className = 'input-row email-row';
    row.innerHTML = '<input type="email" name="emails" class="form-control" value=""><button type="button" class="btn btn-outline-danger remove-email">Remove</button>';
    wrapper.appendChild(row);
  } else if (e.target && e.target.classList.contains('remove-phone')) {
    e.target.closest('.phone-row').remove();
  } else if (e.target && e.target.classList.contains('remove-email')) {
    e.target.closest('.email-row').remove();
  }
});
</script>

</div> <!-- .candidate-card -->
{% endblock %}


<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var el = document.querySelector('input[name="application_date"]');
    if(el && (!el.value || el.value.trim() === '')){
      el.value = new Date().toISOString().slice(0,10);
    }
  } catch(e){ console.error(e); }
});
</script>
